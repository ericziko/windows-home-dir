import{Ab as M,Bb as j,Cc as te,Gb as H,Hb as Y,Jb as J,Kb as K,Lb as Q,Lc as l,Mb as X,Nb as Z,c as I,d as E,ea as $,fa as U,hb as x,jb as k,k as h,kb as v,lb as W,mb as b,ob as N,qb as F,r as C,sb as B,y as q,yc as ee,zb as G}from"./chunk-BAOGVYAT.js";var u=I(E());var se="https://learn.microsoft.com/sql/database-engine/configure-windows/enable-encrypted-connections-to-the-database-engine",oe="https://aka.ms/sqlopsfirewallhelp";var y=I(E()),r=I(C()),O=({context:e,value:t,target:s,type:i,props:n})=>{let[a,m]=(0,y.useState)(t),[d,A]=(0,y.useState)(!1);(0,y.useEffect)(()=>{m(t)},[t]);let g=f=>{m(f),e?.formAction({propertyName:s,isAction:!1,value:f,updateValidation:!1})},T=()=>{e?.formAction({propertyName:s,isAction:!1,value:a,updateValidation:!0})};return(0,r.jsxs)(r.Fragment,{children:[i==="input"&&(0,r.jsx)(F,{value:a,onChange:(f,c)=>g(c.value),onBlur:T,size:"small",...n}),i==="password"&&(0,r.jsx)(F,{type:d?"text":"password",value:a,onChange:(f,c)=>g(c.value),onBlur:T,size:"small",contentAfter:(0,r.jsx)(x,{onClick:()=>A(!d),icon:d?(0,r.jsx)($,{}):(0,r.jsx)(U,{}),appearance:"transparent",size:"small"}),...n}),i==="textarea"&&(0,r.jsx)(H,{value:a,size:"small",onChange:(f,c)=>g(c.value),onBlur:T,...n})]})},xe=({context:e,component:t,idx:s,props:i,componentProps:n})=>{if(!t){console.error("Form component is undefined");return}let a=P();return(0,r.jsxs)("div",{className:a.formComponentDiv,children:[(0,r.jsx)(v,{validationMessage:t.validation?.validationMessage??"",orientation:t.type==="checkbox"?"horizontal":"vertical",validationState:t.validation?t.validation.isValid?"none":"error":"none",required:t.required,label:t.tooltip?{children:(m,d)=>(0,r.jsx)(te,{...d,info:t.tooltip,children:t.label})}:t.label,...i,style:{color:q.colorNeutralForeground1},children:ne(e,t,n)}),t?.actionButtons?.length>0&&(0,r.jsx)("div",{className:a.formComponentActionDiv,children:t.actionButtons?.map((m,d)=>(0,r.jsx)(x,{appearance:"outline",style:{width:"120px"},onClick:()=>e?.formAction({propertyName:t.propertyName,isAction:!0,value:m.id}),children:m.label},d+m.id))})]},s)};function ne(e,t,s){let i=e.state.formState;switch(t.type){case"input":return(0,r.jsx)(O,{context:e,value:i[t.propertyName]??"",target:t.propertyName,type:"input",props:s});case"textarea":return(0,r.jsx)(O,{context:e,value:i[t.propertyName]??"",target:t.propertyName,type:"textarea",props:s});case"password":return(0,r.jsx)(O,{context:e,value:i[t.propertyName]??"",target:t.propertyName,type:"password",props:s});case"dropdown":if(t.options===void 0)throw new Error("Dropdown component must have options");return(0,r.jsx)(N,{size:"small",placeholder:t.placeholder??"",value:t.options.find(n=>n.value===i[t.propertyName])?.displayName??"",selectedOptions:[i[t.propertyName]],onOptionSelect:(n,a)=>{e?.formAction({propertyName:t.propertyName,isAction:!1,value:a.optionValue})},...s,children:t.options?.map((n,a)=>(0,r.jsx)(b,{value:n.value,children:n.displayName},t.propertyName+a))});case"checkbox":return(0,r.jsx)(W,{size:"medium",checked:i[t.propertyName]??!1,onChange:(n,a)=>e?.formAction({propertyName:t.propertyName,isAction:!1,value:a.checked}),...s})}}var P=h({formRoot:{display:"flex",flexDirection:"column",height:"100%"},formDiv:{padding:"10px",maxWidth:"600px",display:"flex",flexDirection:"column","> *":{margin:"5px"}},formComponentDiv:{"> *":{margin:"5px"}},formComponentActionDiv:{display:"flex",flexDirection:"row","> *":{margin:"5px"}},formNavTrayButton:{width:"150px",alignSelf:"center",margin:"0px 10px"},formNavTray:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"10px 0px"},formNavTrayRight:{display:"flex",marginLeft:"auto"}});var o=I(C());var ie=h({ipInputBox:{marginLeft:"8px",marginRight:"8px",width:"120px"}}),Ae=({state:e,addFirewallRule:t,closeDialog:s,signIntoAzure:i})=>{let n=ie(),a=P(),[m,d]=(0,u.useState)(e.tenants.length>0?e.tenants[0].id:""),[A,g]=(0,u.useState)(e.tenants.length>0?R(e.tenants[0]):"");(0,u.useEffect)(()=>{e.tenants.length>0&&(d(e.tenants[0].id),g(R(e.tenants[0])))},[e.tenants]),(0,u.useEffect)(()=>{e.clientIp&&(_(D(e.clientIp,0)),z(D(e.clientIp,255)))},[e.clientIp]);let[T,f]=(0,u.useState)("ClientIPAddress_"+le(new Date)),[c,re]=(0,u.useState)("specificIp"),[L,_]=(0,u.useState)(D(e.clientIp,0)),[V,z]=(0,u.useState)(D(e.clientIp,255)),ae=(S,p)=>{d(p.selectedOptions.length>0?p.selectedOptions[0]:""),g(p.optionText??"")};return(0,o.jsx)(Y,{open:!0,children:(0,o.jsx)(X,{children:(0,o.jsxs)(K,{children:[(0,o.jsx)(Q,{children:e.serverName?l.firewallRules.createNewFirewallRuleFor(e.serverName):l.firewallRules.createNewFirewallRule}),(0,o.jsxs)(Z,{children:[(0,o.jsx)(ee,{intent:"error",style:{paddingRight:"12px"},children:e.message}),(0,o.jsx)("br",{}),(0,o.jsxs)("div",{style:{marginBottom:"12px"},children:[l.firewallRules.firewallRuleNeededMessage," ",(0,o.jsx)(B,{href:oe,children:l.connectionDialog.readMore})]}),!e.isSignedIn&&(0,o.jsxs)(o.Fragment,{children:[l.firewallRules.signIntoAzureToAddFirewallRule," ",(0,o.jsx)(B,{onClick:()=>{i()},children:l.firewallRules.signIntoAzure})]}),e.isSignedIn&&(0,o.jsxs)(o.Fragment,{children:[e.tenants.length>0&&(0,o.jsx)(v,{label:l.firewallRules.tenant,className:a.formComponentDiv,children:(0,o.jsx)(N,{value:A,selectedOptions:[m],onOptionSelect:ae,children:e.tenants.map(S=>(0,o.jsx)(b,{text:R(S),value:S.id,children:R(S)},S.id))})}),(0,o.jsx)(v,{label:l.firewallRules.ruleName,className:a.formComponentDiv,children:(0,o.jsx)(F,{value:T,onChange:(S,p)=>{f(p.value)},id:"ruleName"})}),(0,o.jsx)(v,{className:a.formComponentDiv,children:(0,o.jsxs)(G,{value:c,onChange:(S,p)=>re(p.value),children:[(0,o.jsx)(M,{label:l.firewallRules.addMyClientIp(e.clientIp),value:"specificIp"}),(0,o.jsx)(M,{label:l.firewallRules.addMySubnetRange,value:"ipRange"})]})}),(0,o.jsxs)("div",{className:a.formComponentDiv,style:{marginLeft:"40px"},children:[(0,o.jsx)(k,{children:"From"}),(0,o.jsx)(F,{value:L,onChange:(S,p)=>{_(p.value)},id:"startIpInput",disabled:c==="specificIp",className:n.ipInputBox}),(0,o.jsx)(k,{children:"To"}),(0,o.jsx)(F,{value:V,onChange:(S,p)=>{z(p.value)},id:"endIpInput",disabled:c==="specificIp",className:n.ipInputBox})]})]})]}),(0,o.jsxs)(J,{children:[(0,o.jsx)(x,{appearance:"primary",onClick:()=>{t({name:T,tenantId:m,ip:c==="specificIp"?e.clientIp:{startIp:L,endIp:V}})},disabled:!e.isSignedIn,icon:e.addFirewallRuleState==="loading"?(0,o.jsx)(j,{size:"tiny"}):void 0,children:l.firewallRules.addFirewallRule}),(0,o.jsx)(x,{appearance:"secondary",onClick:()=>{s()},children:l.common.cancel})]})]})})})};function w(e){return e.toString().padStart(2,"0")}function le(e){return[e.getFullYear(),w(e.getMonth()+1),w(e.getDate())].join("-")+"_"+[w(e.getHours()),w(e.getMinutes()),w(e.getSeconds())].join("-")}function R({name:e,id:t}){return`${e} (${t})`}function D(e,t){return e.replace(/\.[0-9]+$/g,`.${t}`)}export{se as a,xe as b,P as c,Ae as d};
